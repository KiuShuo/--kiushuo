## APNs Devicetoken

iOS APNS远程推送


1.推送证书：Dev、Production(两个)共三个，分别是：
Dev:
Apple Push Notification service SSL (Sandbox)
Production:

还不太确定这个的用途：
Apple Push Notification Authentication Key (Sandbox & Production)
使用他后，可以为我们提供一个 key 给后台，避免我们的推送证书过期的问题 ，它是说这样设置后永远不会过期，除非我们删掉它，但是目前还没用过！
Apple Push Notification基于令牌的身份验证是使用提供程序证书连接到APN的替代方法。 提供者API支持JSON Web Token（或JWT），一个开放标准，将推送消息与认证声明一起传递到APN。

Apple Push Notification service SSL (Sandbox & Production)
一般都用这一个，一个应用对应一个。

2.后台推送到苹果服务器包含两个环境：debug、release；
3.使用ADHoc描述文件打的安装包需要使用Release推送证书进行推送；
4.做完推送证书以后会影响到已经做完的开发发布描述文件，具体表现为：描述文件的状态变为黄色的Invalid，这是因为描述文件中有包含是否有推送功能，当做推送证书的时候需要选择对应的应用id，所以做完推送证书之后就表明对应id的应用有了推送功能，所以之前没有勾选推送功能的测试发布描述文件就会失效，没关系，只要重新生成一个新的描述文件就行了；


DeviceToken：
deviceToken的组成：设备UDID和app的bundleID混编而成。
UDID: 设备的唯一设备识别符

某一用户对应的deviceToken发生变化的几种情况：
1.当app的bundleID发生变化的时候；
2.当用户在新设备上登陆的后（设备UDID发生改变，例如设备越狱）；
3.当用户更新操作系统的时候；
3.iOS9以及其之后的系统，当用户在同一设备上删除应用并重新安装后；



为避免iOS少推或者重复推送消息，请考虑一下几种情况：

首先判断给哪个设备上的哪个应用推送消息的唯一标志：deviceToken（会发生改变），iOS设备只能被动的接受来自服务器的消息，不能拦截。

1.请确定推送消息是否与用户相关?

2.考虑下面的几种情况下消息的推送情况:

当用户仅安装应用而没有登陆的时候，是否发送推送消息？

当用户登陆的时候，考虑一下两种情况：

同一用户 -> 对应多台设备（设备唯一标志UUID不会发生改变，出刷机外等极少数情况下）-> 每台设备对应的devickToken会发生改变
给哪台设备上的应用推送消息？

同一设备 -> 对应多个用户
给哪个用户推送消息？


重新卸载安装后deviceToken的变化：
iOS8 不会改变。
562264ee 3ba1843d fc05a8e1 418327ae bd0b21e9 aa78d65a b14901f7 ff334ad9
562264ee 3ba1843d fc05a8e1 418327ae bd0b21e9 aa78d65a b14901f7 ff334ad9
562264ee 3ba1843d fc05a8e1 418327ae bd0b21e9 aa78d65a b14901f7 ff334ad9

iOS9 发生改变后之前的deviceToken失效。
f598bc0b 28dba8f2 e38b542c 200fd519 bad11e78 e43e5242 b834d086 01160936
a81e8074 0c14703d 1ec91038 01171d26 8847a6fc ccb91c2c 5a3a2d28 1242f3fa

iOS10 删除重装前后的device token 
06F85E3168D3C0651D0FAE009A013503D8703CF41BE66FB9E3E117CB96A943CA
EB1A4D57FEE9148B478E23059400A75FDFE82DAB3B6A665463D658468AB97F7B

